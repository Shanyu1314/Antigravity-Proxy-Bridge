# 更新日志

## [v1.1.0] - 2026-01-30

### 🚀 新增功能

#### 1. 智能场景自动探测
- **优先全自动探测**：脚本启动后自动扫描 `$HOME/.antigravity-server`
- 自动识别哈希路径和服务器模式
- 仅在无法确定时才显示交互选项
- 提供确认机制，用户可选择接受或手动选择

#### 2. 增强的端口联通性预检
- 在注入代理配置前检测代理端口是否开启
- 支持多种检测方式：`nc`、`telnet`、bash 内置 `/dev/tcp`
- 提供详细的错误提示和解决方案
- 强提醒用户确保 SSH RemoteForward 或代理服务已就绪

#### 3. 文件哈希审计日志
- 在 `install.log` 中记录注入时的文件哈希值（SHA256）
- 方便用户在版本更新后进行比对
- 支持 Language Server 和 Main JS 文件的哈希记录

### 🔧 改进优化

#### 1. 解决文件占用冲突
- 在替换 Language Server 二进制文件前执行 `rm -f`
- 避免在 Antigravity 运行状态下出现 "Text file busy" 错误
- 支持热更新场景

#### 2. 优化恢复（Restore）逻辑
- 在 `uninstall.sh` 中采用 `rm + mv` 方式
- 确保即便在运行中也能成功复原原始二进制文件
- 自动恢复可执行权限

#### 3. 增强的错误提示
- 代理端口未开启时提供详细的排查步骤
- 列出可能的原因和解决方案
- 支持用户选择是否继续配置

### 📝 技术细节

#### 自动探测逻辑
```bash
1. 检查 $HOME/.antigravity-server 目录是否存在
2. 查找哈希值目录（服务器版特征）
3. 验证 language_server_linux_x64 文件存在
4. 自动设置为服务器版场景
5. 询问用户确认
```

#### 端口检测优先级
```bash
1. nc -z -w2 (最快最可靠)
2. timeout + telnet (备用方案)
3. bash /dev/tcp (最后备用)
```

#### 文件替换策略
```bash
# 旧方式（可能失败）
cp new_file old_file

# 新方式（避免占用）
rm -f old_file
mv new_file old_file
```

### 🐛 修复问题

- 修复：Antigravity 运行时无法替换二进制文件
- 修复：卸载时可能遇到的文件占用问题
- 改进：代理端口检测的准确性和兼容性

### 📖 文档更新

- 更新 `TESTING_GUIDE.md` 添加新功能测试说明
- 更新 `README.md` 说明自动探测功能
- 添加 `CHANGELOG.md` 记录版本变更

### ⚠️ 破坏性变更

无破坏性变更，完全向后兼容 v1.0.0

### 🔄 升级指南

从 v1.0.0 升级到 v1.1.0：

```bash
# 1. 拉取最新代码
cd Antigravity-Proxy-Bridge
git pull

# 2. 如果已安装，先卸载
sudo ./uninstall.sh

# 3. 重新安装
sudo ./setup.sh
```

---

## [v1.0.0] - 2026-01-29

### 🎉 首次发布

#### 核心功能
- 智能网络环境检测
- 三种使用场景支持（桌面版/服务器版/Remote-SSH）
- 路径自动探测（支持哈希路径）
- 无损备份机制
- 一键卸载功能
- 详细日志记录

#### 文档
- 完整的中英文 README
- 安装指南
- 故障排查文档
- Remote-SSH 配置指南
- 技术架构文档

#### 测试
- 网络测试脚本
- 路径检测测试脚本
- 完整的测试指南

---

## 版本规范

本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范：

- **主版本号（Major）**：不兼容的 API 修改
- **次版本号（Minor）**：向下兼容的功能性新增
- **修订号（Patch）**：向下兼容的问题修正

## 贡献

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License
